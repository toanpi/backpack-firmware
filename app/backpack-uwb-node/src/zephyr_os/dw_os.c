/************************************************************************************************************
Module:       dw_os

Revision:     1.0

Description:  ---

Notes:        ---

History:
Date          Name      Changes
-----------   ----      -------------------------------------------------------------------------------------
03/26/2024    TH       Began Coding    (TH = Toan Huynh)

COPYRIGHT Â© 2024 TOAN HUYNH. ALL RIGHTS RESERVED.

THIS SOURCE IS TOAN HUYNH PROPRIETARY AND CONFIDENTIAL! NO PART OF THIS
SOURCE MAY BE DISCLOSED IN ANY MANNER TO A THIRD PARTY WITHOUT PRIOR WRITTEN
CONSENT OF TOAN HUYNH.
************************************************************************************************************/

//###########################################################################################################
//      #INCLUDES
//###########################################################################################################
#include <stdint.h>
#include <zephyr/kernel.h>



//###########################################################################################################
//      TESTING #DEFINES
//###########################################################################################################



//###########################################################################################################
//      CONSTANT #DEFINES
//###########################################################################################################



//###########################################################################################################
//      MACROS
//###########################################################################################################



//###########################################################################################################
//      MODULE TYPES
//###########################################################################################################



//###########################################################################################################
//      CONSTANTS
//###########################################################################################################



//###########################################################################################################
//      MODULE LEVEL VARIABLES
//###########################################################################################################


//###########################################################################################################
//      PRIVATE FUNCTION PROTOTYPES
//###########################################################################################################
// Host connection lock
K_MUTEX_DEFINE(host_connection_mutex);



//###########################################################################################################
//      PUBLIC FUNCTIONS
//###########################################################################################################

void host_connection_lock(void)
{
  // Zephyr OS lock
  k_mutex_lock(&host_connection_mutex, K_FOREVER);
}

void host_connection_unlock(void)
{
  // Zephyr OS unlock
  k_mutex_unlock(&host_connection_mutex);
}


void* sys_malloc(size_t size) {
  return k_malloc(size); 
}

void sys_free(void* ptr) { 
  k_free(ptr); 
}


void deca_sleep(unsigned int time_ms) {
	k_sleep(K_MSEC(time_ms));
}

void Sleep(uint32_t delay) {
    deca_sleep(delay);
}

void usleep(uint32_t delay_us) {
    k_sleep(K_USEC(delay_us));
}


/* @fn    portGetTickCnt
 * @brief wrapper for to read a SysTickTimer, which is incremented with
 *        CLOCKS_PER_SEC frequency.
 *        The resolution of time32_incr is usually 1/1000 sec.
 * */
unsigned long portGetTickCnt(void)
{
    return k_uptime_get_32();
}

/* @fn 	  portGetTickCntMicro
* @brief  function to read a SysTickTimer modified by its count to get a higher resolution timestamp.
* 		  The resolution is usually one microsecond.
* */
unsigned long long portGetTickCntMicro(void)
{
    return k_uptime_get();
}



//###########################################################################################################
//      PRIVATE FUNCTIONS
//###########################################################################################################


//###########################################################################################################
//      INTERRUPTS
//###########################################################################################################



//###########################################################################################################
//      TEST HARNESSES
//###########################################################################################################



//###########################################################################################################
//      END OF dw_os.c
//###########################################################################################################
