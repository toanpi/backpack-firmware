/************************************************************************************************************
Module:       dev_storage

Revision:     1.0

Description:  ---

Notes:        ---

History:
Date          Name      Changes
-----------   ----      -------------------------------------------------------------------------------------
03/03/2022    TH       Began Coding    (TH = Toan Huynh)

COPYRIGHT Â© 2022 TOAN HUYNH.  ALL RIGHTS RESERVED.

THIS SOURCE IS TOAN HUYNH PROPRIETARY AND CONFIDENTIAL!  NO PART OF THIS
SOURCE MAY BE DISCLOSED IN ANY MANNER TO A THIRD PARTY WITHOUT PRIOR WRITTEN
CONSENT OF TOAN HUYNH.
************************************************************************************************************/

//###########################################################################################################
//      #INCLUDES
//###########################################################################################################
#include <stdio.h>
#include <stdbool.h>
#include <string.h>
#include "dev_storage.h"
#include "FreeRTOS.h"
#include "task.h"
#include "int_flash_driver.h"
#include "sys_config.h"
#include "memory_map.h"


//###########################################################################################################
//      TESTING #DEFINES
//###########################################################################################################

//###########################################################################################################
//      CONSTANT #DEFINES
//###########################################################################################################

//###########################################################################################################
//      MACROS
//###########################################################################################################

//###########################################################################################################
//      MODULE TYPES
//###########################################################################################################

//###########################################################################################################
//      CONSTANTS
//###########################################################################################################
#define ENABLE_FLASH 1


//###########################################################################################################
//      MODULE LEVEL VARIABLES
//###########################################################################################################
#if !ENABLE_FLASH
uint8_t ram[256];
#endif

//###########################################################################################################
//      PRIVATE FUNCTION PROTOTYPES
//###########################################################################################################

//###########################################################################################################
//      PUBLIC FUNCTIONS
//###########################################################################################################

/********************************************************************************
Function:
  devStorageInit()
Input Parameters:
  ---
Output Parameters:
  ---
Description:
  ---
Notes:
  ---
Author, Date:
  Toan Huynh, 03/03/2022
*********************************************************************************/
void devStorageInit(void)
{
  // Do nothing
}

/********************************************************************************
Function:
  devStorageTest()
Input Parameters:
  ---
Output Parameters:
  ---
Description:
  ---
Notes:
  ---
Author, Date:
  Toan Huynh, 03/03/2022
*********************************************************************************/
bool devStorageTest()
{
  uint8_t test;

  return devStorageRead(0, &test, 1);
}

/********************************************************************************
Function:
  devStorageRead()
Input Parameters:
  ---
Output Parameters:
  ---
Description:
  ---
Notes:
  ---
Author, Date:
  Toan Huynh, 03/03/2022
*********************************************************************************/
bool devStorageRead(int address, void *data, size_t length)
{
#if ENABLE_FLASH
  const uint32_t *addr = (uint32_t *)LPS_NODE_ROM_ADDR;

  memcpy(data, addr, length);
  return true;

#else
  memcpy(data, ram + address, length);
  return true;
#endif
}

/********************************************************************************
Function:
  devStorageHasData()
Input Parameters:
  ---
Output Parameters:
  ---
Description:
  ---
Notes:
  ---
Author, Date:
  Toan Huynh, 03/03/2022
*********************************************************************************/
bool devStorageHasData(int address)
{
  return true;
}

/********************************************************************************
Function:
  devStorageWrite()
Input Parameters:
  ---
Output Parameters:
  ---
Description:
  ---
Notes:
  ---
Author, Date:
  Toan Huynh, 03/03/2022
*********************************************************************************/
bool devStorageWrite(int address, void *data, size_t length)
{
#if ENABLE_FLASH
  int_flash_program_page(LPS_NODE_ROM_ADDR, data, length);
  return true;
#else
  memcpy(ram + address, data, length);
  return true;
#endif
}

/********************************************************************************
Function:
  devStorageClear()
Input Parameters:
  ---
Output Parameters:
  ---
Description:
  ---
Notes:
  ---
Author, Date:
  Toan Huynh, 03/03/2022
*********************************************************************************/
void devStorageClear(void)
{
  int_flash_erase_page(LPS_NODE_ROM_ADDR);
}

//###########################################################################################################
//      PRIVATE FUNCTIONS
//###########################################################################################################

//###########################################################################################################
//      INTERRUPTS
//###########################################################################################################

//###########################################################################################################
//      TEST HARNESSES
//###########################################################################################################

//###########################################################################################################
//      END OF dev_storage.c
//###########################################################################################################
