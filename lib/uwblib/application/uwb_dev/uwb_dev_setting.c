/************************************************************************************************************
Module:       uwb_dev_setting

Revision:     1.0

Description:  ---

Notes:        ---

History:
Date          Name      Changes
-----------   ----      -------------------------------------------------------------------------------------
05/10/2022    TH       Began Coding    (TH = Toan Huynh)

COPYRIGHT Â© 2022 TOAN HUYNH.  ALL RIGHTS RESERVED.

THIS SOURCE IS TOAN HUYNH PROPRIETARY AND CONFIDENTIAL!  NO PART OF THIS
SOURCE MAY BE DISCLOSED IN ANY MANNER TO A THIRD PARTY WITHOUT PRIOR WRITTEN
CONSENT OF TOAN HUYNH.
************************************************************************************************************/

//###########################################################################################################
//      #INCLUDES
//###########################################################################################################
#include "uwb_dev_setting.h"
#include "deca_regs.h"
#include "deca_param_types.h"





//###########################################################################################################
//      TESTING #DEFINES
//###########################################################################################################



//###########################################################################################################
//      CONSTANT #DEFINES
//###########################################################################################################

#define CONFIG_NORMAL_PEAK_MULTPLIER  (0x60) // 3
#define CONFIG_NORMAL_NTM             (13)
#define LDE_NORMAL_CONFIG1            (CONFIG_NORMAL_PEAK_MULTPLIER | CONFIG_NORMAL_NTM)
#define LDE_NORMAL_CONFIG2_16         (0x1607)
#define LDE_NORMAL_CONFIG2_64         (0x0607)

#define CONFIG_LOW_PEAK_MULTPLIER     (0x0) // 0
#define CONFIG_LOW_NTM                (7)
#define LDE_LOW_CONFIG1               (CONFIG_LOW_PEAK_MULTPLIER | CONFIG_LOW_NTM)
#define LDE_LOW_CONFIG2_16            (0x0003)
#define LDE_LOW_CONFIG2_64            (0x0003)


//###########################################################################################################
//      MACROS
//###########################################################################################################



//###########################################################################################################
//      MODULE TYPES
//###########################################################################################################



//###########################################################################################################
//      CONSTANTS
//###########################################################################################################



//###########################################################################################################
//      MODULE LEVEL VARIABLES
//###########################################################################################################



//###########################################################################################################
//      PRIVATE FUNCTION PROTOTYPES
//###########################################################################################################



//###########################################################################################################
//      PUBLIC FUNCTIONS
//###########################################################################################################
/********************************************************************************
Function:
  uwb_dev_set_rx_detect_threshold()
Input Parameters:
  ---
Output Parameters:
  ---
Description:
  Set the threshold for the RX detect.
Notes:
  ---
Author, Date:
  Toan Huynh, 05/10/2022
*********************************************************************************/
bool uwb_dev_set_rx_detect_threshold(instance_data_t *inst, rx_detect_threshold_e threshold)
{
  bool ret = true;
  uint8_t lde_cfg1 = 0;
  uint16_t lde_cfg2 = 0;

  switch (threshold)
  {
  case RDT_NORMAL:
    lde_cfg1 = LDE_NORMAL_CONFIG1;
    lde_cfg2 = (inst->chConfig.pulseRepFreq == DWT_PRF_64M) ? LDE_NORMAL_CONFIG2_64 : LDE_NORMAL_CONFIG2_16;
    break;

  case RDT_LOW:
    lde_cfg1 = LDE_LOW_CONFIG1;
    lde_cfg2 = (inst->chConfig.pulseRepFreq == DWT_PRF_64M) ? LDE_LOW_CONFIG2_64 : LDE_LOW_CONFIG2_16;
    break;

  default:
    ret = false;
    break;
  }

  if (ret)
  {
    // 8-bit configuration register
    dwt_write8bitoffsetreg(LDE_IF_ID, LDE_CFG1_OFFSET, lde_cfg1);
    // 16-bit LDE configuration tuning register
    dwt_write16bitoffsetreg(LDE_IF_ID, LDE_CFG2_OFFSET, lde_cfg2);
  }

  return ret;
}

//###########################################################################################################
//      PRIVATE FUNCTIONS
//###########################################################################################################


//###########################################################################################################
//      INTERRUPTS
//###########################################################################################################



//###########################################################################################################
//      TEST HARNESSES
//###########################################################################################################



//###########################################################################################################
//      END OF uwb_dev_setting.c
//###########################################################################################################
